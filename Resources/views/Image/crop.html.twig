{% extends 'ClarityImagesBundle:Image:layout.html.twig' %}

{% block title %}{{ 'form.crop_image.title'|trans|capitalize }}{% endblock %}

{% block body %}
{% include 'ClarityImagesBundle:Image:crop_form.html.twig' %}
{% endblock %}

{% block javascripts %}
<script>
(function($) {
    $("[data-destination={{ id }}]").modal("show");
    var formAction = $('[data-destination={{ id }}] form').attr('action');
    if (formAction.length > 0) {
        $('[data-destination={{ id }}] input[type=file]').ajaxfileupload({
            action: formAction,
            submit_button: $('[data-action=upload_close]'),
            onComplete: function(response) {
                $('[data-action=upload_close]').unbind('click').attr('data-action', 'crop_close');
                $('[data-destination={{ id }}] .modal-body').html(response);
                $('img#crop-{{ id }}').on('load', function() {
                    $(this).Jcrop();
                    $('[data-action=crop_close]').on('click', function(e) {

                    });
                });
            }
        });    
    }
}(jQuery));
</script>
{% endblock %}